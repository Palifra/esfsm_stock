===============================
ESFSM - Stock & Fleet Integration
===============================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: LGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-Palifra%2Fesfsm__stock-lightgray.png?logo=github
    :target: https://github.com/Palifra/esfsm_stock
    :alt: Palifra/esfsm_stock

|badge1| |badge2| |badge3|

This module extends the ESFSM (Enterprise Service Field Management) suite with
comprehensive material tracking and fleet integration capabilities.

**Key Features:**

* Automatic stock location creation for fleet vehicles
* Complete material lifecycle tracking (planned → taken → used → returned)
* Smart source location detection with priority logic
* Team and technician vehicle assignment
* Material management wizards for adding and returning materials
* Real-time job material cost tracking
* Multi-company support
* Full constraint validation

**Table of contents**

.. contents::
   :local:

Configuration
=============

Vehicle Setup
~~~~~~~~~~~~~

1. Navigate to **Fleet → Vehicles**
2. Create or edit a vehicle
3. Upon saving, a stock location is automatically created under "Возила" (Vehicles)
4. The location name format is: "Возило - [LICENSE_PLATE]"

Team and Employee Assignment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Assign vehicles to teams:
   * Go to **Field Service → Configuration → Teams**
   * Edit team and set **Vehicle** field
   * Team's stock location is automatically linked to vehicle's location

2. Assign vehicles to employees:
   * Go to **Employees → Employee → Edit**
   * Set **Vehicle** field on employee form

Product Configuration
~~~~~~~~~~~~~~~~~~~~~

Ensure materials used in field service have:

* **Type**: Consumable or Storable Product
* **Unit of Measure**: Properly configured
* **Standard Price**: Set for automatic price population

Usage
=====

Material Lifecycle
~~~~~~~~~~~~~~~~~~

The module tracks materials through four distinct stages:

1. **Планирано (Planned)**: Estimated quantity needed for the job
2. **Земено (Taken)**: Quantity picked from warehouse/vehicle
3. **Искористено (Used)**: Quantity consumed on the job site
4. **Вратено (Returned)**: Unused quantity returned to warehouse

Adding Materials to Jobs
~~~~~~~~~~~~~~~~~~~~~~~~~

**Method 1: Direct Entry**

1. Open job form view
2. Navigate to **Материјали (Materials)** tab
3. Click **Add a line**
4. Select product - UoM and price are auto-populated
5. Enter planned and taken quantities

**Method 2: Add Materials Wizard**

1. Click **Додади материјали (Add Materials)** button on job form
2. Add products and quantities in wizard
3. Click **Потврди (Confirm)**
4. Materials are added with taken_qty set
5. Existing materials are updated (no duplicates)

Returning Materials
~~~~~~~~~~~~~~~~~~~

1. Click **Врати материјали (Return Materials)** button on job
2. Wizard auto-populates with returnable materials
3. Adjust return quantities if needed (supports partial returns)
4. Click **Потврди (Confirm)**
5. Material returned_qty is updated
6. Message is posted to job chatter

Location Priority Logic
~~~~~~~~~~~~~~~~~~~~~~~~

When determining source location for materials, the system uses this priority:

1. **Team Vehicle Location** (if job has team with vehicle)
2. **Technician Vehicle Location** (if job has employee with vehicle)
3. **Warehouse Location** (default fallback)

This ensures materials are sourced from the most appropriate location.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues
<https://github.com/Palifra/esfsm_stock/issues>`_. In case of trouble, please
check there if your issue has already been reported. If you spotted it first,
help us smashing it by providing a detailed and welcomed feedback.

Credits
=======

Authors
~~~~~~~

* ЕСКОН-ИНЖЕНЕРИНГ ДООЕЛ Струмица

Contributors
~~~~~~~~~~~~

* Filip Rajković <filip@eskon.com.mk>

Maintainers
~~~~~~~~~~~

This module is maintained by ESKON Engineering.

.. image:: https://www.eskon.com.mk/logo.png
   :alt: ESKON Engineering
   :target: https://www.eskon.com.mk

ESKON Engineering provides industrial automation, electrical installations, and
IT solutions in North Macedonia. This module is part of our open-source
contribution to the Odoo community.

To contribute to this module, please visit https://github.com/Palifra/esfsm_stock.
